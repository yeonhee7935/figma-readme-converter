<!DOCTYPE html>
<html>
<head>
  <style>
    :root {
      --primary-color: #18a0fb;
      --primary-hover: #0d8edd;
      --text-color: #333;
      --border-color: #e0e0e0;
      --light-bg: #f8f8f8;
      --info-bg: #e6f7ff;
      --info-border: #1890ff;
      --font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      --border-radius: 6px;
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-xxl: 48px;
      
      /* Font Sizes */
      --font-xs: 12px;
      --font-sm: 13px;
      --font-md: 14px;
      --font-lg: 16px;
      --font-xl: 18px;
      --font-xxl: 20px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: var(--font-family);
      margin: 0;
      padding: var(--spacing-md);
      color: var(--text-color);
      font-size: var(--font-md);
      line-height: 1.5;
      background-color: white;
    }
    
    h1, h2, h3 {
      font-weight: 500;
      color: #111;
    }
    
    h1 {
      font-size: var(--font-xxl);
      margin-bottom: var(--spacing-lg);
    }
    
    h2 {
      font-size: var(--font-lg);
      margin-bottom: var(--spacing-md);
      margin-top: var(--spacing-xl);
      padding-bottom: var(--spacing-xs);
      border-bottom: 1px solid var(--border-color);
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: var(--spacing-lg);
    }
    
    .tab {
      padding: var(--spacing-xs) var(--spacing-md);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }
    
    .tab:hover {
      background-color: rgba(24, 160, 251, 0.05);
    }
    
    .tab.active {
      border-bottom-color: var(--primary-color);
      font-weight: 500;
      color: var(--primary-color);
    }
    
    /* Tab content */
    .tab-content {
      display: none;
      padding-top: var(--spacing-md);
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* Form elements */
    textarea {
      width: 100%;
      height: 250px;
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-sm);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-family: monospace;
      resize: vertical;
      line-height: 1.4;
      font-size: 13px;
      transition: border-color 0.2s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(24, 160, 251, 0.2);
    }
    
    /* Settings */
    .settings-section:first-of-type h2 {
      margin-top: 0;
    }
    
    .settings-section {
      margin-bottom: var(--spacing-xxl);
      /* padding-bottom: var(--spacing-md); */
    }
    
    .settings-row {
      display: flex;
      margin-bottom: var(--spacing-md);
      align-items: center;
    }
    
    .settings-label {
      flex: 1;
      min-width: 140px;
      font-weight: 500;
      font-size: var(--font-sm);
    }
    
    .settings-input {
      flex: 2;
    }
    
    input[type="number"],
    input[type="text"],
    input[type="color"],
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      transition: all 0.2s ease;
    }
    
    input:focus,
    select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(24, 160, 251, 0.2);
    }
    
    /* Buttons */
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 500;
      margin-right: var(--spacing-xs);
      transition: all 0.2s ease;
    }
    
    button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    button:active {
      transform: translateY(0);
      box-shadow: none;
    }
    
    button.secondary {
      background-color: #f0f0f0;
      color: var(--text-color);
    }
    
    button.secondary:hover {
      background-color: #e0e0e0;
    }
    
    .buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--spacing-md);
    }
    
    /* Preview */
    .preview {
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
      background-color: var(--light-bg);
      margin-top: var(--spacing-md);
      max-height: 200px;
      overflow-y: auto;
    }
    
    .preview-title {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: var(--spacing-xs);
    }
    
    /* Info box */
    .info {
      margin-top: var(--spacing-md);
      padding: var(--spacing-sm);
      background-color: var(--info-bg);
      border-radius: var(--border-radius);
      border-left: 4px solid var(--info-border);
    }
    
    /* Lists */
    ul {
      padding-left: 20px;
      margin-bottom: var(--spacing-md);
    }
    
    li {
      margin-bottom: 6px;
      font-size: var(--font-sm);
    }
    
    /* Additional spacing */
    p {
      margin-bottom: var(--spacing-md);
      font-size: var(--font-sm);
      line-height: 1.6;
    }
    h5{
      margin-bottom: 16px;
     }
  </style>
</head>
<body>
  <h1>Markdown to Figma</h1>
  
  <div class="tabs">
    <div class="tab active" data-tab="convert">변환</div>
    <div class="tab" data-tab="settings">설정</div>
    <div class="tab" data-tab="help">도움말</div>
  </div>
  
  <div class="tab-content active" id="convert-tab">
    <textarea id="markdown-input" placeholder="마크다운 텍스트를 여기에 붙여넣으세요...
예시:
# 제목
## 부제목
일반 텍스트 내용입니다. 
- 항목 1
- 항목 2
  - 중첩 항목

---
# 새 페이지 제목"></textarea>
    
    <div class="buttons">
      <button id="convert-button">변환하기</button>
    </div>
  </div>
  
  <div class="tab-content" id="settings-tab">
    <div class="settings-section">
      <h5>프레임 설정</h5>
      <div class="settings-row">
        <div class="settings-label">프레임 너비(px):</div>
        <div class="settings-input">
          <input type="number" id="frame-width" value="1440">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">프레임 높이(px):</div>
        <div class="settings-input">
          <input type="number" id="frame-height" value="1080">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">패딩(px):</div>
        <div class="settings-input">
          <input type="number" id="padding" value="100">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">프레임 간격(px):</div>
        <div class="settings-input">
          <input type="number" id="frame-spacing" value="100">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">요소 간격(px):</div>
        <div class="settings-input">
          <input type="number" id="element-spacing" value="24">
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <h5>텍스트 설정</h5>
      <div class="settings-row">
        <div class="settings-label">기본 텍스트 크기(px):</div>
        <div class="settings-input">
          <input type="number" id="text-size" value="36">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">행간(px):</div>
        <div class="settings-input">
          <input type="number" id="line-height" value="64">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">자간(%):</div>
        <div class="settings-input">
          <input type="number" id="letter-spacing" value="-2.5" step="0.1">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">텍스트 색상:</div>
        <div class="settings-input">
          <input type="color" id="text-color" value="#121212">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">글꼴:</div>
        <div class="settings-input">
          <select id="font-family">
            <option value="Inter">Inter</option>
            <!-- 다른 글꼴 옵션들은 동적으로 추가됨 -->
          </select>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <h5>헤딩 크기 설정</h5>
      <div class="settings-row">
        <div class="settings-label">H1 크기(px):</div>
        <div class="settings-input">
          <input type="number" id="h1-size" value="100">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">H2 크기(px):</div>
        <div class="settings-input">
          <input type="number" id="h2-size" value="72">
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-label">H3 크기(px):</div>
        <div class="settings-input">
          <input type="number" id="h3-size" value="54">
        </div>
      </div>
    </div>
    
    <div class="buttons">
      <button id="save-settings">저장</button>
    </div>
  </div>
  
  <div class="tab-content" id="help-tab">
    <div class="settings-section">
      <h5>사용 방법</h5>
      <p>이 플러그인은 Markdown 형식의 텍스트를 Figma 프레임으로 변환합니다.</p>
    </div>
    
    <div class="settings-section">
      <h5>지원하는 Markdown 구문</h5>
      <ul>
        <li><strong>헤딩</strong>: # 제목, ## 부제목, ### 소제목</li>
        <li><strong>일반 텍스트</strong>: 헤딩 사이의 모든 텍스트는 하나의 블록으로 처리됩니다.</li>
        <li><strong>페이지 구분</strong>: --- (구분선)</li>
      </ul>
    </div>
    
    <div class="settings-section">
      <h5>팁</h5>
      <ul>
        <li>헤딩은 각 섹션의 시작을 나타냅니다.</li>
        <li>헤딩이 아닌 모든 텍스트(목록 포함)는 하나의 텍스트 블록으로 처리됩니다.</li>
        <li>구분선(---)은 새로운 프레임을 생성합니다 (Instagram 캐러셀용).</li>
        <li>프레임 크기는 항상 고정되며, 내용이 넘치면 잘립니다.</li>
        <li>요소 간의 간격을 설정하여 레이아웃을 조정할 수 있습니다.</li>
        <li>프레임이 10개 이상일 경우 자동으로 줄바꿈됩니다.</li>
      </ul>
    </div>
  </div>
  
  <script>
    // 탭 전환 함수
    function switchTab(tabId) {
      // 모든 탭과 탭 콘텐츠 비활성화
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      // 선택한 탭과 탭 콘텐츠 활성화
      document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
      document.getElementById(`${tabId}-tab`).classList.add('active');
    }
    
    // 탭 클릭 이벤트 리스너
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        switchTab(tab.getAttribute('data-tab'));
      });
    });
    
    // 현재 설정 값 가져오기
    function getSettings() {
      return {
        frameWidth: parseInt(document.getElementById('frame-width').value) || 1440,
        frameHeight: parseInt(document.getElementById('frame-height').value) || 1080,
        padding: parseInt(document.getElementById('padding').value) || 100,
        frameSpacing: parseInt(document.getElementById('frame-spacing').value) || 100,
        elementSpacing: parseInt(document.getElementById('element-spacing').value) || 24,
        textSize: parseInt(document.getElementById('text-size').value) || 36,
        lineHeight: parseInt(document.getElementById('line-height').value) || 64,
        letterSpacing: parseFloat(document.getElementById('letter-spacing').value) || -2.5,
        textColor: document.getElementById('text-color').value,
        fontFamily: document.getElementById('font-family').value,
        headingSizes: {
          h1: parseInt(document.getElementById('h1-size').value) || 100,
          h2: parseInt(document.getElementById('h2-size').value) || 72,
          h3: parseInt(document.getElementById('h3-size').value) || 54
        }
      };
    }
    
    // 마크다운 변환 버튼 클릭 이벤트
    document.getElementById('convert-button').addEventListener('click', () => {
      const markdown = document.getElementById('markdown-input').value;
      
      if (!markdown.trim()) {
        alert('변환할 마크다운 내용을 입력해주세요.');
        return;
      }
      
      const settings = getSettings();
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'convert-markdown', 
          markdown,
          settings
        }
      }, '*');
    });
    
    // 설정 저장 버튼 클릭 이벤트
    document.getElementById('save-settings').addEventListener('click', () => {
      const settings = getSettings();
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'save-settings', 
          settings
        }
      }, '*');
    });
    
    // 플러그인으로부터 메시지 수신
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      
      if (!msg) return;
      
      // 설정 로드
      if (msg.type === 'load-settings') {
        const settings = msg.settings;
        
        document.getElementById('frame-width').value = settings.frameWidth;
        document.getElementById('frame-height').value = settings.frameHeight;
        document.getElementById('padding').value = settings.padding;
        document.getElementById('frame-spacing').value = settings.frameSpacing || 100;
        document.getElementById('element-spacing').value = settings.elementSpacing || 24;
        document.getElementById('text-size').value = settings.textSize;
        document.getElementById('line-height').value = settings.lineHeight || 64;
        document.getElementById('letter-spacing').value = settings.letterSpacing || -2.5;
        document.getElementById('text-color').value = settings.textColor;
        document.getElementById('h1-size').value = settings.headingSizes.h1;
        document.getElementById('h2-size').value = settings.headingSizes.h2;
        document.getElementById('h3-size').value = settings.headingSizes.h3;
        
        // 폰트 설정 (폰트 목록이 로드된 후)
        if (settings.fontFamily) {
          const fontSelect = document.getElementById('font-family');
          // 기존 옵션 중에 일치하는 것이 있는지 확인
          for (let i = 0; i < fontSelect.options.length; i++) {
            if (fontSelect.options[i].value === settings.fontFamily) {
              fontSelect.selectedIndex = i;
              break;
            }
          }
        }
      }
      
      // 폰트 목록 로드
      if (msg.type === 'fonts-list') {
        const fontSelect = document.getElementById('font-family');
        const savedFont = fontSelect.value; // 현재 선택된 폰트 저장
        
        fontSelect.innerHTML = '';
        
        msg.fonts.forEach(font => {
          const option = document.createElement('option');
          option.value = font;
          option.textContent = font;
          fontSelect.appendChild(option);
        });
        
        // 저장된 폰트로 선택 복원
        for (let i = 0; i < fontSelect.options.length; i++) {
          if (fontSelect.options[i].value === savedFont) {
            fontSelect.selectedIndex = i;
            break;
          }
        }
      }
    };
  </script>
</body>
</html>